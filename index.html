<!DOCTYPE html>
<html lang="es-PE">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>App Didáctica: Drawback Perú | Eric Mozombite</title>
    
    <!-- FAVICON SUNAT -->
    <link rel="icon" href="https://www.sunat.gob.pe/img/favicon.7124d68e.ico" type="image/x-icon">
    
    <!-- Scripts & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&family=Space+Grotesk:wght@500;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Palette: Professional & Energetic */
            --bg-app: #F8FAFC;
            --primary: #0F172A;
            --accent: #2563EB;
            --accent-light: #DBEAFE;
            --secondary: #06B6D4;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --purple: #8B5CF6;
            --white: #FFFFFF;
            --border: #E2E8F0;
            --nav-height: 75px;
            --radius: 20px;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; padding: 0; 
            font-family: 'Inter', sans-serif; 
            background-color: #CBD5E1; 
            color: var(--primary); 
            height: 100dvh; overflow: hidden; 
            display: flex; justify-content: center; align-items: center; 
        }
        
        /* Layout Structure */
        .app-container { 
            width: 100%; height: 100%; background: var(--bg-app); 
            position: relative; overflow: hidden; 
            display: flex; flex-direction: column-reverse; 
        }
        @media (min-width: 1024px) {
            .app-container { max-width: 1200px; height: 95vh; border-radius: var(--radius); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); flex-direction: row; }
        }
        
        /* Navigation */
        .nav-bar { 
            background: var(--white); border-top: 1px solid var(--border); 
            height: var(--nav-height); display: flex; justify-content: space-around; 
            align-items: center; z-index: 100; padding-bottom: env(safe-area-inset-bottom); 
            flex-shrink: 0; box-shadow: 0 -4px 20px rgba(0,0,0,0.03); 
        }
        @media (min-width: 1024px) {
            .nav-bar { width: 260px; height: 100%; flex-direction: column; justify-content: flex-start; border-top: none; border-right: 1px solid var(--border); padding: 2rem 1rem; gap: 0.5rem; box-shadow: none; overflow-y: auto; }
        }
        .nav-item { background: none; border: none; display: flex; flex-direction: column; align-items: center; color: #94A3B8; font-size: 0.65rem; gap: 4px; cursor: pointer; transition: all 0.3s; padding: 8px; flex: 1; font-weight: 600; }
        .nav-item i { font-size: 1.4rem; margin-bottom: 2px; transition: transform 0.2s; }
        @media (min-width: 1024px) {
            .nav-item { flex-direction: row; font-size: 0.95rem; padding: 12px 20px; width: 100%; border-radius: 12px; gap: 12px; flex: 0; }
            .nav-item i { font-size: 1.2rem; margin-bottom: 0; width: 24px; }
        }
        .nav-item.active { color: var(--accent); font-weight: 800; }
        .nav-item.active i { transform: scale(1.15); color: var(--accent); }
        @media (min-width: 1024px) { 
            .nav-item.active { background: var(--accent); color: white !important; }
            .nav-item.active i { color: white; }
        }
        
        /* Content Area */
        .content-area { flex: 1; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        .section { position: absolute; top: 0; left: 0; right: 0; bottom: 0; overflow-y: auto; scroll-behavior: smooth; opacity: 0; pointer-events: none; transform: translateY(20px); transition: opacity 0.4s ease, transform 0.4s ease; background: var(--bg-app); display: flex; flex-direction: column; }
        .section.active { opacity: 1; pointer-events: auto; transform: translateY(0); z-index: 10; }
        .sticky-header { position: sticky; top: 0; background: rgba(248, 250, 252, 0.95); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); padding: 1.5rem 1.5rem 1rem 1.5rem; z-index: 20; border-bottom: 1px solid rgba(0,0,0,0.05); flex-shrink: 0; }
        .section-content { padding: 1rem 1.5rem 6rem 1.5rem; overflow-y: auto; flex: 1; }
        
        /* Typography */
        h1 { font-family: 'Space Grotesk'; font-size: 2.2rem; line-height: 1.1; margin: 0; color: var(--primary); text-align: center; }
        h2 { font-family: 'Space Grotesk'; font-size: 1.5rem; margin: 0; color: var(--accent); text-align: left; }
        h3 { font-size: 1.1rem; font-weight: 700; margin: 0 0 0.5rem 0; color: var(--primary); text-align: left; }
        p, li, .card-body, .timeline-content, .text-justify { font-size: 0.95rem; line-height: 1.6; color: #475569; margin-bottom: 1rem; text-align: justify; }
        .subtitle { font-size: 0.75rem; color: #64748B; font-weight: 800; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 0.25rem; display: block; }
        
        /* Interactive Cards */
        .interactive-card { background: white; border-radius: 16px; margin-bottom: 1rem; border: 1px solid var(--border); overflow: hidden; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .interactive-card:hover { border-color: var(--secondary); transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.05);}
        .interactive-card.active { border-color: var(--accent); box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.1); transform: translateY(0);}
        
        .card-header { padding: 1.2rem; display: flex; align-items: center; gap: 1rem; cursor: pointer; user-select: none; }
        .card-header:active { background-color: #F8FAFC; }
        .card-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; flex-shrink: 0; }
        
        .card-body { padding: 0 1.2rem 1.2rem 1.2rem; display: none; animation: slideDown 0.3s ease; border-top: 1px solid #F1F5F9; margin-top: -0.5rem; padding-top: 1rem; }
        .card-body.show { display: block; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Chart Container */
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 280px; max-height: 400px; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        
        /* Simulator Specifics */
        .calc-screen { background: linear-gradient(145deg, #0F172A, #1E293B); color: white; border-radius: 20px; padding: 1rem; box-shadow: 0 15px 35px -5px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; gap: 0.5rem;}
        
        .sim-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden; transition: all 0.3s ease; }
        .sim-card-header { padding: 0.75rem 1rem; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: #CBD5E1; user-select: none; transition: 0.3s; }
        .sim-card-header:hover { background: rgba(255,255,255,0.05); }
        .sim-card-body { padding: 0 1rem 1rem 1rem; display: none; animation: slideDown 0.3s ease; }
        
        .sim-card.active .sim-card-body { display: block; }
        .sim-card.active .sim-card-header { color: white; border-bottom: 1px solid rgba(255,255,255,0.05); margin-bottom: 0.5rem;}
        .sim-card.active .fa-chevron-down { transform: rotate(180deg); }

        .calc-input-group { margin-bottom: 0.5rem; }
        .calc-input { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: white; font-size: 1.1rem; padding: 0.5rem; border-radius: 10px; outline: none; font-family: 'Space Grotesk'; transition: 0.3s; font-weight: 600; }
        .calc-input:focus { border-color: var(--secondary); background: rgba(255,255,255,0.1); box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.2);}
        .calc-deduction { border-color: rgba(245, 158, 11, 0.4); color: #FCD34D; }
        
        .custom-checkbox { display: flex; align-items: flex-start; gap: 0.5rem; padding: 0.6rem; background: rgba(255,255,255,0.05); border-radius: 10px; cursor: pointer; transition: 0.2s; border: 1px solid transparent; height: 100%; }
        .custom-checkbox:hover { background: rgba(255,255,255,0.08); border-color: rgba(255,255,255,0.2); }
        .custom-checkbox input[type="checkbox"] { appearance: none; width: 18px; height: 18px; background: rgba(255,255,255,0.2); border-radius: 4px; flex-shrink: 0; position: relative; cursor: pointer; margin-top: 2px; }
        .custom-checkbox input[type="checkbox"]:checked { background: var(--danger); }
        .custom-checkbox input[type="checkbox"]:checked::after { content: '\f00d'; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 11px; }
        
        /* Timeline */
        .timeline { position: relative; padding-left: 1.5rem; margin: 1rem 0; }
        .timeline::before { content: ''; position: absolute; left: 6px; top: 5px; bottom: 5px; width: 2px; background: #E2E8F0; }
        .timeline-item { position: relative; margin-bottom: 1.5rem; }
        .timeline-item::after { content: ''; position: absolute; left: -1.5rem; top: 6px; width: 10px; height: 10px; border-radius: 50%; background: var(--accent); border: 2px solid white; box-shadow: 0 0 0 2px var(--accent); }
    </style>
</head>
<body>

<div class="app-container">
    
    <!-- NAVBAR -->
    <nav class="nav-bar">
        <button class="nav-item active" onclick="nav('home')"><i class="fa-solid fa-house"></i><span>Inicio</span></button>
        <button class="nav-item" onclick="nav('teoria')"><i class="fa-solid fa-graduation-cap"></i><span>Conceptos</span></button>
        <button class="nav-item" onclick="nav('historia')"><i class="fa-solid fa-chart-line"></i><span>Debate</span></button>
        <button class="nav-item" onclick="nav('reglas')"><i class="fa-solid fa-scale-unbalanced"></i><span>Reglas</span></button>
        <button class="nav-item" onclick="nav('simulador')"><i class="fa-solid fa-laptop-code"></i><span>Simulador</span></button>
        <button class="nav-item" onclick="nav('fuentes')"><i class="fa-solid fa-book-bookmark"></i><span>Fuentes</span></button>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="content-area">
        
        <!-- 1. INICIO -->
        <section id="home" class="section active">
            <div style="height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 2rem; background: linear-gradient(135deg, #ECFEFF 0%, #FFFFFF 100%);">
                <div style="background: var(--warning); color: white; padding: 8px 20px; border-radius: 50px; font-weight: 800; font-size: 0.85rem; margin-bottom: 1.5rem; letter-spacing: 1px; box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);">RÉGIMEN ADUANERO PROMOCIONAL</div>
                
                <h1 style="margin-bottom: 1rem; font-size: 3rem;">El Drawback<br><span style="color:var(--secondary)">Peruano</span></h1>
                
                <p class="text-center" style="max-width: 450px; color: #64748B; font-size: 1.1rem;">Aprende de manera didáctica cómo funciona la restitución arancelaria, su debate actual y audita tu exportación.</p>
                
                <div style="background: white; padding: 1.5rem; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.05); margin: 2rem 0; border: 1px solid var(--border); width: 100%; max-width: 300px; position: relative; overflow: hidden;">
                    <div style="position: absolute; top:0; left:0; right:0; height: 4px; background: var(--secondary);"></div>
                    <div style="font-size: 0.85rem; text-transform: uppercase; color: #94A3B8; font-weight: 800; margin-bottom: 5px;">Tasa Vigente Restitución</div>
                    <div style="font-size: 4rem; font-weight: 800; color: var(--primary); font-family: 'Space Grotesk'; line-height: 1;">3%</div>
                    <div style="font-size: 0.85rem; color: #64748B; margin-top: 5px; font-weight: 500;">del Valor FOB Neto</div>
                </div>
                
                <div style="margin-top: 1rem; text-align: center;">
                    <button onclick="nav('teoria')" style="background: var(--accent); color: white; border: none; padding: 1rem 2.5rem; border-radius: 50px; font-weight: 700; font-size: 1.1rem; cursor: pointer; box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3); margin-bottom: 1.5rem; transition: transform 0.2s;">Iniciar Recorrido <i class="fa-solid fa-arrow-right ml-2"></i></button>
                    <div style="font-size: 0.9rem; font-weight: 600; color: #94A3B8;">Investigación: Eric Mozombite</div>
                </div>
            </div>
        </section>

        <!-- 2. CONCEPTOS -->
        <section id="teoria" class="section">
            <header class="sticky-header">
                <span class="subtitle">MÓDULO 1: CONCEPTOS</span>
                <h2>Fundamentos y Control</h2>
            </header>
            <div class="section-content">
                <p class="mb-4 text-justify">Toca la cabecera de cada tarjeta para abrir o cerrar la información.</p>

                <!-- Tarjeta 1 (Cerrada por defecto) -->
                <div class="interactive-card">
                    <div class="card-header bg-slate-50" onclick="toggleCard(this)">
                        <div class="card-icon" style="background: var(--accent);"><i class="fa-solid fa-lightbulb"></i></div>
                        <div style="flex:1;">
                            <div class="font-bold text-slate-800">Filosofía y Definición</div>
                            <div class="text-xs text-slate-500">Objetivo del D.S. N° 104-95-EF</div>
                        </div>
                        <i class="fa-solid fa-chevron-down text-slate-400 transition-transform duration-300"></i>
                    </div>
                    <div class="card-body">
                        <p class="mt-2 text-justify">El Drawback es el Procedimiento Simplificado de Restitución de Derechos Arancelarios. Permite a los <strong>productores-exportadores</strong> recuperar un porcentaje del valor de exportación, si el costo de su producto se encareció al pagar impuestos (aranceles) por insumos importados.</p>
                        <div style="background: #EFF6FF; border-left: 4px solid var(--accent); padding: 1.2rem; border-radius: 0 12px 12px 0; margin-top: 1rem;">
                            <h4 style="color: var(--accent); font-weight: 800; font-size: 0.95rem; margin-bottom: 0.5rem;"><i class="fa-solid fa-bullseye mr-2"></i> El Principio: "No exportar impuestos"</h4>
                            <p style="margin: 0; font-size: 0.9rem; color: #1E40AF; text-justify">Garantiza que los sobrecostos de importar materiales no le resten competitividad al producto peruano en el mercado internacional.</p>
                        </div>
                    </div>
                </div>

                <!-- Tarjeta 2 (Cerrada) -->
                <div class="interactive-card">
                    <div class="card-header bg-slate-50" onclick="toggleCard(this)">
                        <div class="card-icon" style="background: var(--secondary);"><i class="fa-solid fa-box-open"></i></div>
                        <div style="flex:1;">
                            <div class="font-bold text-slate-800">Insumos Incorporables</div>
                            <div class="text-xs text-slate-500">Según directivas de PromPerú</div>
                        </div>
                        <i class="fa-solid fa-chevron-down text-slate-400 transition-transform duration-300"></i>
                    </div>
                    <div class="card-body">
                        <p class="mt-2 text-sm text-justify">Para aplicar, el bien exportado debe contener físicamente materiales importados que hayan pagado el 100% de sus derechos arancelarios. Estos se dividen en:</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center">
                                <i class="fa-solid fa-vial text-purple-500 text-3xl mb-3"></i>
                                <h4 class="font-bold text-slate-800 text-sm">Materias Primas</h4>
                                <p class="text-[0.75rem] text-slate-500 mt-2">Sustancias que sufren transformación. Ej: Tela importada para fabricar prendas.</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center">
                                <i class="fa-solid fa-puzzle-piece text-secondary text-3xl mb-3"></i>
                                <h4 class="font-bold text-slate-800 text-sm">Piezas y Partes</h4>
                                <p class="text-[0.75rem] text-slate-500 mt-2">Elementos que se ensamblan al producto. Ej: Cierres, botones o etiquetas.</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center">
                                <i class="fa-solid fa-box text-warning text-3xl mb-3"></i>
                                <h4 class="font-bold text-slate-800 text-sm">Envases</h4>
                                <p class="text-[0.75rem] text-slate-500 mt-2">Material que protege el producto. Ej: Cajas clamshell para agroexportación.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tarjeta 3 (Cerrada) -->
                <div class="interactive-card">
                    <div class="card-header bg-slate-50" onclick="toggleCard(this)">
                        <div class="card-icon" style="background: var(--purple);"><i class="fa-solid fa-file-signature"></i></div>
                        <div style="flex:1;">
                            <div class="font-bold text-slate-800">Control Aduanero Documentario</div>
                            <div class="text-xs text-slate-500">¿Qué exige la SUNAT (ESAN)?</div>
                        </div>
                        <i class="fa-solid fa-chevron-down text-slate-400 transition-transform duration-300"></i>
                    </div>
                    <div class="card-body">
                        <p class="mt-2 text-sm text-justify">La fiscalización de SUNAT requiere trazabilidad perfecta. La empresa debe demostrar contable y físicamente la relación importación-producción-exportación.</p>
                        <ul class="list-disc pl-5 space-y-2 mt-3 text-sm text-slate-600">
                            <li><strong>DAM de Importación:</strong> Prueba indubitable de la nacionalización y pago de impuestos.</li>
                            <li><strong>Facturas Comerciales:</strong> Demuestran la adquisición y respaldan el valor FOB final declarado.</li>
                            <li><strong>Kardex y Cuadro Insumo-Producto:</strong> Documentos críticos que prueban matemáticamente qué cantidad exacta del insumo importado se utilizó en cada unidad exportada (mermas incluidas).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. DEBATE Y REFORMA -->
        <section id="historia" class="section">
            <header class="sticky-header">
                <span class="subtitle">MÓDULO 2: CONTEXTO POLÍTICO</span>
                <h2>Historia y Propuestas de Reforma</h2>
            </header>
            <div class="section-content">
                <p class="mb-4 text-justify">El Drawback es uno de los regímenes más debatidos. Explora su cronología de tensiones políticas y por qué se plantea su reforma estructural.</p>

                <!-- Tarjeta Historia Chart (Cerrada) -->
                <div class="interactive-card">
                    <div class="card-header bg-slate-50 border-l-4 border-accent" onclick="toggleCard(this, renderHistoryChart)">
                        <div class="card-icon" style="background: var(--accent);"><i class="fa-solid fa-chart-line"></i></div>
                        <div style="flex:1;">
                            <div class="font-bold text-slate-800">Evolución de las Tasas</div>
                            <div class="text-xs text-slate-500">La "montaña rusa" porcentual</div>
                        </div>
                        <i class="fa-solid fa-chevron-down text-slate-400 transition-transform duration-300"></i>
                    </div>
                    <div class="card-body">
                        <p class="text-sm mt-2 text-justify">La tasa ha servido como herramienta macroeconómica. Subió al 8% como rescate frente a la crisis Subprime (2009), y ha bajado paulatinamente hasta el 3% actual debido al impacto de los Tratados de Libre Comercio (TLCs) que redujeron naturalmente los aranceles.</p>
                        <div class="chart-container mt-4">
                            <canvas id="historyChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Tarjeta Intentos Anulación (Cerrada) -->
                <div class="interactive-card">
                    <div class="card-header bg-slate-50 border-l-4 border-danger" onclick="toggleCard(this)">
                        <div class="card-icon" style="background: var(--danger);"><i class="fa-solid fa-ban"></i></div>
                        <div style="flex:1;">
                            <div class="font-bold text-slate-800">Intentos de Anulación</div>
                            <div class="text-xs text-slate-500">Fechas en las que el Drawback tembló</div>
                        </div>
                        <i class="fa-solid fa-chevron-down text-slate-400 transition-transform duration-300"></i>
                    </div>
                    <div class="card-body">
                        <p class="mt-2 text-sm text-justify">Diversos gobiernos han intentado eliminar o recortar drásticamente este beneficio, argumentando que distorsiona el mercado y genera forados fiscales injustificados.</p>
                        <div class="timeline mt-4">
                            <div class="timeline-item">
                                <div class="timeline-date text-danger">Año 2015 (Gestión MEF Alonso Segura)</div>
                                <div class="timeline-content text-sm text-justify">El MEF consideró que el beneficio estaba sobredimensionado y planteó su eliminación progresiva. Se inició un proceso de "sinceramiento" publicando un decreto para recortar la tasa del 5% al 4% en 2015 y luego al 3% en 2016.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date text-danger">Octubre 2024 (Gestión MEF José Arista)</div>
                                <div class="timeline-content text-sm text-justify">Ante una grave crisis de recaudación fiscal, el MEF preparó un decreto supremo para recortar el Drawback del 3% a <strong>1% o incluso 0.5%</strong>. La medida fue abortada en el último minuto tras una enorme presión política y mediática de los principales gremios exportadores.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tarjeta El Debate (Cerrada) -->
                <div class="interactive-card">
                    <div class="card-header bg-slate-50 border-l-4 border-warning" onclick="toggleCard(this)">
                        <div class="card-icon" style="background: var(--warning);"><i class="fa-solid fa-screwdriver-wrench"></i></div>
                        <div style="flex:1;">
                            <div class="font-bold text-slate-800">El Debate de la Reforma</div>
                            <div class="text-xs text-slate-500">¿Por qué y cómo modificarlo?</div>
                        </div>
                        <i class="fa-solid fa-chevron-down text-slate-400 transition-transform duration-300"></i>
                    </div>
                    <div class="card-body">
                        <div style="background: #FEF2F2; padding: 1.2rem; border-radius: 12px; border: 1px solid #FECACA; margin-top: 10px;">
                            <h4 style="color: #DC2626; font-weight: 700; font-size: 0.95rem; margin-bottom: 0.5rem;"><i class="fa-solid fa-circle-question mr-1"></i> ¿Por qué se propone reformarlo?</h4>
                            <ul class="list-disc pl-5 space-y-2 text-sm text-red-900 text-justify">
                                <li><strong>Es un "Subsidio Ciego":</strong> Al ser una tasa plana (3% del FOB total), las empresas a menudo reciben del Estado mucho más dinero del que realmente pagaron en aranceles. Es decir, reciben dinero extra que no corresponde a una restitución real.</li>
                                <li><strong>Concentración de Riqueza:</strong> Investigaciones (como la de Ojo Público) demostraron que un puñado de grandes corporaciones agroindustriales captaron S/ 9,000 millones en 10 años, desvirtuando el fin original de "ayudar a la PYME".</li>
                                <li><strong>Convergencia de TLCs:</strong> Hoy, la mayoría de insumos entran con 0% de arancel, por lo que el reintegro general pierde justificación técnica.</li>
                            </ul>
                        </div>
                        
                        <div style="background: #EFF6FF; padding: 1.2rem; border-radius: 12px; border: 1px solid #BFDBFE; margin-top: 1rem;">
                            <h4 style="color: #1D4ED8; font-weight: 700; font-size: 0.95rem; margin-bottom: 0.5rem;"><i class="fa-solid fa-wand-magic-sparkles mr-1"></i> ¿De qué manera sería la reforma?</h4>
                            <ul class="list-disc pl-5 space-y-2 text-sm text-blue-900 text-justify">
                                <li><strong>Hacia un Drawback Real o "Perfecto":</strong> Eliminar el porcentaje fijo sobre el valor FOB. En su lugar, el sistema aduanero calcularía y devolvería <em>únicamente el monto exacto y comprobado</em> que la empresa pagó como arancel al importar el insumo.</li>
                                <li><strong>Focalización Exclusiva:</strong> Restringir legalmente el beneficio para que solo puedan acogerse las Micro y Pequeñas Empresas (MYPEs) reales, excluyendo de la matriz a la gran minería, pesca industrial y agroindustria gigante.</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- 4. REGLAS -->
        <section id="reglas" class="section">
            <header class="sticky-header">
                <span class="subtitle">MÓDULO 3: RESTRICCIONES</span>
                <h2 class="text-xl md:text-2xl">Reglas y Limitaciones Legales</h2>
            </header>
            <div class="section-content">
                <p class="mb-4 text-justify">El procedimiento aduanero (DESPA-PG.07) establece "candados" estrictos para evitar fraudes.</p>

                <!-- Tarjeta Regla 50% (Cerrada) -->
                <div class="interactive-card">
                    <div class="card-header bg-slate-50 border-l-4 border-success" onclick="toggleCard(this, renderLimitChart)">
                        <div class="card-icon" style="background: var(--success);"><i class="fa-solid fa-scale-unbalanced"></i></div>
                        <div style="flex:1;">
                            <div class="font-bold text-slate-800">La Regla del Valor CIF (50%)</div>
                            <div class="text-xs text-slate-500">Asegurando el componente nacional</div>
                        </div>
                        <i class="fa-solid fa-chevron-down text-slate-400 transition-transform duration-300"></i>
                    </div>
                    <div class="card-body">
                        <p class="text-sm mt-2 text-justify">Para que un producto se considere "exportación peruana", el valor CIF de <strong>todos</strong> los insumos importados <strong>no puede superar el 50%</strong> del valor FOB del producto final. Si es 51%, se rechaza.</p>
                        <div class="chart-container mt-4">
                            <canvas id="limitChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Tarjeta Exclusiones (Cerrada) -->
                <div class="interactive-card">
                    <div class="card-header bg-slate-50 border-l-4 border-danger" onclick="toggleCard(this)">
                        <div class="card-icon" style="background: var(--danger);"><i class="fa-solid fa-handshake-slash"></i></div>
                        <div style="flex:1;">
                            <div class="font-bold text-slate-800">Causales de Exclusión</div>
                            <div class="text-xs text-slate-500">Situaciones donde NO aplica el beneficio</div>
                        </div>
                        <i class="fa-solid fa-chevron-down text-slate-400 transition-transform duration-300"></i>
                    </div>
                    <div class="card-body">
                        <ul class="list-disc pl-5 space-y-3 mt-4 text-sm text-slate-600 text-justify">
                            <li><strong class="text-red-600">El candado del TLC:</strong> Si el insumo ingresó al país pagando 0% de arancel, la aduana rechaza el Drawback. <strong>Estrategia: renunciar al TLC y pagar el arancel para ganar el 3% final.</strong></li>
                            <li><strong class="text-amber-600">Productos Tradicionales:</strong> Exportaciones extractivas crudas (cobre, oro, harina de pescado) están vetadas.</li>
                            <li><strong class="text-purple-600">Límite de US$ 20 Millones:</strong> El beneficio se bloquea si la empresa exporta más de US$ 20M anuales <strong>en una misma subpartida arancelaria</strong>.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. SIMULADOR -->
        <section id="simulador" class="section">
            <header class="sticky-header">
                <span class="subtitle">MÓDULO 4: AUDITORÍA VIRTUAL</span>
                <h2>Simulador Interactivo</h2>
            </header>
            <div class="section-content flex flex-col h-full pb-4">
                
                <p class="mb-4 text-sm text-justify text-slate-500 flex-shrink-0">Ingresa tus datos y abre o cierra las pestañas según necesites. El resultado se actualizará en tiempo real en el panel inferior permanente.</p>

                <div class="calc-screen flex-1 min-h-0 overflow-y-auto custom-scrollbar">
                    
                    <!-- Tarjeta Valores (Cerrada) -->
                    <div class="sim-card">
                        <div class="sim-card-header" onclick="toggleSimCard(this)">
                            <span><i class="fa-solid fa-money-check-dollar text-success mr-2"></i> 1. Ingreso de Valores (US$)</span>
                            <i class="fa-solid fa-chevron-down transition-transform duration-300 text-slate-400"></i>
                        </div>
                        <div class="sim-card-body">
                            <div class="grid grid-cols-1 gap-3 mt-2">
                                <div class="calc-input-group">
                                    <label class="text-[0.65rem] uppercase tracking-widest text-slate-400 font-bold mb-1 block">FOB Bruto (Total Exportado)</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-bold">$</span>
                                        <input type="number" id="fob-input" class="calc-input pl-7" value="100000" oninput="runDrawbackCalc()">
                                    </div>
                                </div>
                                <div class="calc-input-group">
                                    <label class="text-[0.65rem] uppercase tracking-widest text-amber-400 font-bold mb-1 block">Comisiones y Deducciones</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-amber-400 font-bold">-$</span>
                                        <input type="number" id="deducciones-input" class="calc-input calc-deduction pl-8" value="5000" oninput="runDrawbackCalc()">
                                    </div>
                                </div>
                                <div class="calc-input-group">
                                    <label class="text-[0.65rem] uppercase tracking-widest text-secondary font-bold mb-1 block">Costo CIF Insumos Importados</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-bold">$</span>
                                        <input type="number" id="cif-input" class="calc-input pl-7 border-secondary" value="15000" oninput="runDrawbackCalc()">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tarjeta Exclusiones (Cerrada) -->
                    <div class="sim-card mt-2">
                        <div class="sim-card-header" onclick="toggleSimCard(this)">
                            <span><i class="fa-solid fa-list-check text-warning mr-2"></i> 2. Restricciones Legales</span>
                            <i class="fa-solid fa-chevron-down transition-transform duration-300 text-slate-400"></i>
                        </div>
                        <div class="sim-card-body">
                            <p class="text-[0.7rem] text-slate-400 mb-3 text-justify leading-tight">Marca las casillas si tu exportación incurre en alguna de estas faltas. Si marcas alguna, el beneficio será denegado.</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                                <label class="custom-checkbox">
                                    <input type="checkbox" id="exc-tlc" onchange="runDrawbackCalc()">
                                    <span class="text-xs text-slate-300 leading-tight"><strong>Uso de TLC (0%):</strong> El insumo ingresó sin pagar aranceles.</span>
                                </label>
                                <label class="custom-checkbox">
                                    <input type="checkbox" id="exc-trad" onchange="runDrawbackCalc()">
                                    <span class="text-xs text-slate-300 leading-tight"><strong>Tradicional:</strong> Producto excluido por el MEF.</span>
                                </label>
                                <label class="custom-checkbox">
                                    <input type="checkbox" id="exc-20m" onchange="runDrawbackCalc()">
                                    <span class="text-xs text-slate-300 leading-tight"><strong>+US$ 20 Millones:</strong> Tope anual superado en la partida.</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div id="calc-message" class="mt-2 p-3 rounded-xl bg-white/5 border border-slate-700 text-xs text-slate-300 shadow-sm text-justify hidden"></div>

                </div>

                <!-- Panel de Resultado Permanente (Bottom) -->
                <div class="mt-3 bg-[#0B1120] p-4 rounded-xl border border-slate-700 shadow-xl flex flex-col md:flex-row justify-between items-center md:items-end gap-3 flex-shrink-0 z-10 relative">
                    <div class="text-center md:text-left">
                        <div class="text-[0.65rem] font-bold tracking-widest text-slate-400 uppercase mb-1">Estado Auditoría</div>
                        <div id="calc-status" class="px-2 py-1 rounded text-xs font-bold inline-block">APROBADO</div>
                    </div>
                    <div class="text-center md:text-right">
                        <div class="text-[0.65rem] text-slate-400 mb-0.5">Restitución Calculada (3%)</div>
                        <div id="calc-result" class="text-3xl font-bold font-['Space_Grotesk'] tracking-tight text-success">$ 0.00</div>
                    </div>
                </div>

            </div>
        </section>

        <!-- 6. FUENTES -->
        <section id="fuentes" class="section">
            <header class="sticky-header">
                <span class="subtitle">MÓDULO 5: BIBLIOGRAFÍA</span>
                <h2>Fuentes de Información</h2>
            </header>
            <div class="section-content">
                <p class="mb-4 text-justify">El presente informe y sus datos técnicos se sustentan en la siguiente documentación legal, operativa y periodística:</p>

                <div class="space-y-3">
                    <a href="https://www.gob.pe/institucion/mef/normas-legales/2898142-179-2004-ef" target="_blank" class="flex gap-4 p-4 bg-white rounded-xl border border-slate-200 shadow-sm hover:border-accent hover:shadow-md transition-all group">
                        <i class="fa-solid fa-gavel text-primary text-2xl mt-1 group-hover:scale-110 transition-transform"></i>
                        <div>
                            <div class="font-bold text-[0.95rem] text-accent">D.S. N° 179-2004-EF (MEF)</div>
                            <div class="text-xs text-slate-500 mt-1">Texto Único Ordenado de la Ley del Impuesto a la Renta y contexto aduanero.</div>
                        </div>
                    </a>
                    
                    <a href="https://www.sunat.gob.pe/legislacion/procedim/despacho/perfeccionam/drawback/procGeneral/despa-pg.07.htm" target="_blank" class="flex gap-4 p-4 bg-white rounded-xl border border-slate-200 shadow-sm hover:border-secondary hover:shadow-md transition-all group">
                        <i class="fa-solid fa-file-contract text-secondary text-2xl mt-1 group-hover:scale-110 transition-transform"></i>
                        <div>
                            <div class="font-bold text-[0.95rem] text-secondary">Procedimiento DESPA-PG.07 (SUNAT)</div>
                            <div class="text-xs text-slate-500 mt-1">Normativa operativa del Procedimiento General de Restitución de Derechos.</div>
                        </div>
                    </a>
                    
                    <a href="https://exportemos.pe/fortalece-tus-capacidades-exportadoras/logistica-para-exportar/drawback" target="_blank" class="flex gap-4 p-4 bg-white rounded-xl border border-slate-200 shadow-sm hover:border-success hover:shadow-md transition-all group">
                        <i class="fa-solid fa-earth-americas text-success text-2xl mt-1 group-hover:scale-110 transition-transform"></i>
                        <div>
                            <div class="font-bold text-[0.95rem] text-success">Guía Logística (PromPerú)</div>
                            <div class="text-xs text-slate-500 mt-1">Plataforma Exportemos.pe. Guía didáctica y condiciones de insumos.</div>
                        </div>
                    </a>
                    
                    <a href="https://www.esan.edu.pe/conexion-esan/control-aduanero-la-documentacion-sustentatoria-en-el-drawback" target="_blank" class="flex gap-4 p-4 bg-white rounded-xl border border-slate-200 shadow-sm hover:border-purple hover:shadow-md transition-all group">
                        <i class="fa-solid fa-magnifying-glass-chart text-purple text-2xl mt-1 group-hover:scale-110 transition-transform"></i>
                        <div>
                            <div class="font-bold text-[0.95rem] text-purple">Análisis Aduanero (Universidad ESAN)</div>
                            <div class="text-xs text-slate-500 mt-1">Artículo sobre la fiscalización posterior y la documentación sustentatoria obligatoria.</div>
                        </div>
                    </a>
                    
                    <a href="https://ojo-publico.com/5663/drawback-exportadoras-recibieron-s9000-millones-diez-anos" target="_blank" class="flex gap-4 p-4 bg-white rounded-xl border border-slate-200 shadow-sm hover:border-danger hover:shadow-md transition-all group">
                        <i class="fa-solid fa-newspaper text-danger text-2xl mt-1 group-hover:scale-110 transition-transform"></i>
                        <div>
                            <div class="font-bold text-[0.95rem] text-danger">Investigación Especial (Ojo Público)</div>
                            <div class="text-xs text-slate-500 mt-1">Reportaje que destapó la concentración del subsidio en grandes empresas agroindustriales, avivando el debate de reforma estructural.</div>
                        </div>
                    </a>
                </div>
            </div>
        </section>

    </main>
</div>

<script>
    // --- NAVEGACIÓN PRINCIPAL ---
    function nav(sectionId) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        const mapping = ['home', 'teoria', 'historia', 'reglas', 'simulador', 'fuentes'];
        const index = mapping.indexOf(sectionId);
        if (index >= 0) document.querySelectorAll('.nav-item')[index].classList.add('active');
    }

    // --- LÓGICA DE TARJETAS (ACORDEÓN PRINCIPAL) ---
    function toggleCard(headerElement, callback = null) {
        const cardElement = headerElement.parentElement;
        const body = cardElement.querySelector('.card-body');
        const icon = cardElement.querySelector('.fa-chevron-down');
        
        // Verifica si está cerrada comprobando si NO tiene la clase active
        const isClosed = !cardElement.classList.contains('active');

        if (isClosed) {
            // Abrir
            cardElement.classList.add('active');
            body.classList.add('show');
            if (icon) icon.style.transform = 'rotate(180deg)';
            
            // Si hay un gráfico que renderizar (ej. Chart.js), darle un pequeño tiempo para que el display:block se aplique
            if (callback) setTimeout(callback, 100); 
        } else {
            // Cerrar
            cardElement.classList.remove('active');
            body.classList.remove('show');
            if (icon) icon.style.transform = 'rotate(0deg)';
        }
    }

    // --- LÓGICA DE TARJETAS DEL SIMULADOR ---
    function toggleSimCard(headerElement) {
        const cardElement = headerElement.parentElement;
        const body = cardElement.querySelector('.sim-card-body');
        const icon = cardElement.querySelector('.fa-chevron-down');
        const isClosed = !cardElement.classList.contains('active');

        if (isClosed) {
            cardElement.classList.add('active');
            body.classList.add('show');
            if (icon) icon.style.transform = 'rotate(180deg)';
        } else {
            cardElement.classList.remove('active');
            body.classList.remove('show');
            if (icon) icon.style.transform = 'rotate(0deg)';
        }
    }

    // --- MOTOR DEL SIMULADOR ---
    function runDrawbackCalc() {
        const fobBruto = parseFloat(document.getElementById('fob-input').value) || 0;
        const deducciones = parseFloat(document.getElementById('deducciones-input').value) || 0;
        const cif = parseFloat(document.getElementById('cif-input').value) || 0;
        
        const excTlc = document.getElementById('exc-tlc').checked;
        const excTrad = document.getElementById('exc-trad').checked;
        const exc20m = document.getElementById('exc-20m').checked;
        
        const statusEl = document.getElementById('calc-status');
        const resultEl = document.getElementById('calc-result');
        const msgBox = document.getElementById('calc-message');

        const fobNeto = fobBruto - deducciones;
        
        const rejectClassStatus = "px-2 py-1 rounded text-[0.7rem] font-bold bg-red-500/20 text-red-400 border border-red-500/50 tracking-wide";
        const rejectClassResult = "text-2xl font-bold font-['Space_Grotesk'] text-danger mt-1 tracking-tight";
        const rejectClassMsgBox = "mt-3 p-3 rounded-xl bg-red-950/40 border border-red-900/50 text-[0.8rem] text-red-200 shadow-sm text-justify leading-relaxed block";

        // Validar FOB Negativo
        if (fobNeto <= 0) {
            statusEl.innerText = "ERROR EN DATOS";
            statusEl.className = "px-2 py-1 rounded text-[0.7rem] font-bold bg-slate-500/20 text-slate-300 border border-slate-500/50 tracking-wide";
            resultEl.innerText = "$ 0.00";
            resultEl.className = "text-2xl font-bold font-['Space_Grotesk'] text-slate-400 tracking-tight mt-1";
            msgBox.innerHTML = "<i class='fa-solid fa-circle-exclamation text-amber-500 mr-2'></i> El FOB Neto calculado no puede ser negativo.";
            msgBox.className = "mt-3 p-3 rounded-xl bg-slate-800/50 border border-slate-700 text-[0.8rem] text-slate-300 shadow-sm text-justify leading-relaxed block";
            return;
        }

        // Exclusiones marcadas
        if (excTlc || excTrad || exc20m) {
            statusEl.innerText = "DENEGADO";
            statusEl.className = rejectClassStatus;
            resultEl.innerText = "No califica";
            resultEl.className = rejectClassResult;
            
            let razones = "";
            if (excTlc) razones += "<li><strong class='text-red-400'>TLC (0%):</strong> Importaste el insumo sin pagar aranceles (ej. con certificado de origen).</li>";
            if (excTrad) razones += "<li><strong class='text-red-400'>Tradicional:</strong> Tu producto está en la lista de exclusiones del MEF.</li>";
            if (exc20m) razones += "<li><strong class='text-red-400'>Tope Anual:</strong> Has superado los US$ 20 millones en exportación de esta partida.</li>";

            msgBox.className = rejectClassMsgBox;
            msgBox.innerHTML = `<h4 class="font-bold mb-1 text-red-400"><i class="fa-solid fa-ban mr-2"></i> Operación Rechazada</h4>
                                <ul class="list-disc pl-5 space-y-1 text-red-300">${razones}</ul>`;
            return;
        }

        // Regla del 50% CIF
        const cifPercentage = (cif / fobNeto) * 100;
        if (cifPercentage > 50) {
            statusEl.innerText = "DENEGADO (CIF)";
            statusEl.className = rejectClassStatus;
            resultEl.innerText = "Supera 50%";
            resultEl.className = rejectClassResult;
            msgBox.className = rejectClassMsgBox;
            msgBox.innerHTML = `<h4 class="font-bold mb-1 text-red-400"><i class="fa-solid fa-scale-unbalanced mr-2"></i> Falla en Límite CIF</h4>
                                <p class="text-red-200">Tu costo CIF de insumos importados ($${cif.toLocaleString('en-US')}) representa el <span class="font-bold text-red-400">${cifPercentage.toFixed(1)}%</span> de tu FOB Neto. La ley prohíbe superar el 50%.</p>`;
            return;
        } 
        
        // Aprobado
        statusEl.innerText = "AUDITORÍA APROBADA";
        statusEl.className = "px-2 py-1 rounded text-[0.7rem] font-bold bg-emerald-500/20 text-emerald-400 border border-emerald-500/50 tracking-wide";
        const drawback = fobNeto * 0.03; 
        resultEl.innerText = `$ ${drawback.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits:2})}`;
        resultEl.className = "text-3xl md:text-4xl font-bold font-['Space_Grotesk'] text-success tracking-tight";

        msgBox.className = "mt-3 p-3 rounded-xl bg-emerald-950/30 border border-emerald-900/50 text-[0.8rem] text-emerald-100 shadow-sm text-justify leading-relaxed block";
        msgBox.innerHTML = `
            <div class="flex flex-col sm:flex-row justify-between gap-2 items-center">
                <ul class="space-y-0.5 text-[0.75rem] w-full md:w-auto">
                    <li><i class="fa-solid fa-check text-emerald-500 mr-1"></i> Base Imponible: $${fobNeto.toLocaleString('en-US')}</li>
                    <li><i class="fa-solid fa-check text-emerald-500 mr-1"></i> Límite CIF Validado: <span class="font-bold text-emerald-400">${cifPercentage.toFixed(1)}%</span> (Menor al 50%)</li>
                </ul>
            </div>`;
    }

    // --- GRÁFICOS (Chart.js) ---
    function wrapLabel(str, maxChars) {
        if (str.length <= maxChars) return str;
        const words = str.split(' ');
        const lines = [];
        let currentLine = words[0];
        for (let i = 1; i < words.length; i++) {
            if (currentLine.length + 1 + words[i].length <= maxChars) { currentLine += ' ' + words[i]; } 
            else { lines.push(currentLine); currentLine = words[i]; }
        }
        lines.push(currentLine);
        return lines;
    }

    const tooltipConfig = {
        backgroundColor: '#1E293B', titleFont: { size: 13, weight: 'bold' }, bodyFont: { size: 12 }, padding: 10, cornerRadius: 8,
        callbacks: {
            title: function(tooltipItems) {
                const item = tooltipItems[0];
                let label = item.chart.data.labels[item.dataIndex];
                return Array.isArray(label) ? label.join(' ') : label;
            }
        }
    };

    Chart.defaults.font.family = "'Inter', sans-serif";

    let chartHistoryLoaded = false;
    let chartLimitLoaded = false;

    function renderHistoryChart() {
        if (chartHistoryLoaded) return;
        const canvas = document.getElementById('historyChart');
        if (!canvas) return; 
        const ctx = canvas.getContext('2d');
        const rawLabels = ['1995 (Creación)', '2009 (Rescate Crisis)', '2014 (Retorno Tasa)', '2015 (Sinceramiento)', '2026 (Actual)'];
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: rawLabels.map(l => wrapLabel(l, 16)),
                datasets: [{
                    label: 'Tasa Drawback (%)',
                    data: [5, 8, 5, 4, 3],
                    borderColor: '#2563EB',
                    backgroundColor: 'rgba(37, 99, 235, 0.15)',
                    borderWidth: 3, tension: 0.3, fill: true,
                    pointBackgroundColor: '#F59E0B', pointRadius: 6, pointBorderWidth: 2, pointBorderColor: '#fff' 
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false }, tooltip: tooltipConfig },
                scales: { y: { beginAtZero: true, max: 10, title: { display: true, text: 'Tasa Porcentual (%)', font: {weight: 'bold'} } } }
            }
        });
        chartHistoryLoaded = true;
    }

    function renderLimitChart() {
        if (chartLimitLoaded) return;
        const canvas = document.getElementById('limitChart');
        if (!canvas) return; 
        const ctx = canvas.getContext('2d');
        const rawLabels = ['Límite Legal Insumos Importados (CIF)', 'Valor Agregado de Origen Nacional'];
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: rawLabels.map(l => wrapLabel(l, 25)),
                datasets: [{
                    data: [50, 50],
                    backgroundColor: ['#EF4444', '#10B981'],
                    borderWidth: 0, hoverOffset: 8
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false, cutout: '65%',
                plugins: { legend: { position: 'bottom', labels: { font: { size: 12, family: "'Inter', sans-serif" }, padding: 20 } }, tooltip: tooltipConfig }
            }
        });
        chartLimitLoaded = true;
    }

    // Inicializar Simulador
    window.onload = () => {
        runDrawbackCalc(); 
    };
</script>
</body>
</html>
